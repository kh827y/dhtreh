API.GetMeBack 

Ниже описанное API позволяет реализовать следующие механики: 

**Механика I** - Начисление бонусных баллов, оплата части покупки бонусными баллами 

1. Клиент приходит на кассу для оплаты заказа, кассир сканирует QR код (из мобильного приложения) средствами кассы, или если сканирование кодов невозможно вводит вручную цифровое код, который сообщит клиент 
1. Касса отправляет на сервер GetMeBack введённый код ( метод CODE ) 
1. GetMeBack возвращает на кассу данные пользователя (Имя, кол-во накопленных бонусов, другую информацию) 
1. Кассиром принимается решение о списании или зачислении бонусов 
1. Результат решения с суммой начисляемых или списываемых баллов, ранее полученный ID клиента, касса передает обратно на сервер GetMeBack (метод BONUS ) 
1. GetMeBack выдает ответ об успехе операции или ошибку 

**Механика II** - Получение подарка за баллы. 

1. Клиент приходит на кассу, выбирает подарок в приложении, приложение генерирует QR или цифровой код. 
1. Кассир сканирует QR код средствам кассы, или если сканирование кодов невозможно вводит вручную цифровое код, который сообщит клиент 
1. Касса отправляет на сервер GetMeBack введённый код ( метод CODE ) 
1. GetMeBack отвечает на кассу данными пользователя (Имя, кол-во накопленных бонусов, другую информацию), ID подарка который выбрал пользователь 
1. Кассиром принимается решение о выдаче подарков 
1. Касса отправляет на сервер GetMeBack ID клиента, ID выданного подарка (метод GIFT ), либо добавляет подарок в состав чека и отправляет запрос на метод BONUS. 
1. GetMeBack выдает ответ об успехе операции или ошибку 

Обмен данных с GetMeBack происходит с помощью POST http-запросов. Общий формат адреса для всех HTTP запросов: **https://[account].getmeback.ru/rest/base/v33/validator/{method}** 

*Типы данных, описанные в квадратных скобках являются необязательными и могут не передаваться.* 

Тело запроса необходимо отправлять в формате application/json Ответ происходит в формате JSON. 



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|api\_key |string |Ключ доступа к API GetMeBack. |

Обязательные параметры для всех POST запросов: 

Пример запроса к API:

curl -H "Content-Type: application/json" -X POST -d ![](Aspose.Words.81ac4f07-46bc-4635-8829-ce88d217f8c6.001.png)'{"api\_key":"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX","date\_start":"2018-12-01","date\_end":"2018-12-10" }' https://[account].getmeback.ru/rest/base/v33/validator/bonus-list 

Оглавление 

[CODE ........................................................................................................................................................... 2 ](#_page1_x33.00_y573.04)[BONUS......................................................................................................................................................... 4 ](#_page3_x33.00_y473.04)[GIFT ............................................................................................................................................................. 7 ](#_page6_x33.00_y53.04)[COUPON ...................................................................................................................................................... 8 ](#_page7_x33.00_y320.04)[CANCEL-OPERATION ............................................................................................................................... 10 ](#_page9_x33.00_y53.04)[CHECK-GIFT.............................................................................................................................................. 11 ](#_page10_x33.00_y53.04)[BRANCH-LIST ............................................................................................................................................ 12 ](#_page11_x33.00_y53.04)[GIFT-LIST .................................................................................................................................................. 13 ](#_page12_x33.00_y53.04)[GET-USERS............................................................................................................................................... 13 ](#_page12_x33.00_y315.04)[CALCULATE-BONUS ................................................................................................................................. 15 ](#_page14_x33.00_y53.04)[CALCULATE-PROMOTION ....................................................................................................................... 17 ](#_page16_x33.00_y53.04)[BONUS-LIST .............................................................................................................................................. 20 ](#_page19_x33.00_y53.04)[CLIENT-MIGRATION ................................................................................................................................. 22 ](#_page21_x33.00_y192.04)[ADD-STAMPS ............................................................................................................................................ 24 ](#_page23_x33.00_y53.04)

[GIFT-FOR-STAMPS ................................................................................................................................... 25 ](#_page24_x33.00_y53.04)[FIND-BONUS ............................................................................................................................................. 26 ](#_page25_x33.00_y53.04)

Методы API:

<a name="_page1_x33.00_y573.04"></a>CODE 

Метод определяет желаемое действие клиента(начисление бонусов или получение подарка) по коду из приложения. 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/code* **Параметры запроса:** 

|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|code |string |Код, который клиент сообщил кассиру или был отсканирован с экрана телефона |

**Возвращаемые значения:** 

|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|type |gift | bonus | coupon |Тип операции: **bonus** - начисление/списание бонусов **gift** - выдача подарков **coupon** - активация купона |
|client |Array |<p>Массив с описанием клиента: </p><p>**id\_client** - ID клиента </p><p>**id\_device** - ID устройства клиента </p><p>**id\_ext** - ID клиента в внешней системе </p><p>**name** - Имя клиента </p><p>**phone** - Телефон клиента </p><p>**email** - почта клиент </p><p>**balance** - Баланс бонусных баллов **k\_bonus** - коэффициент начисления бонусных баллов(в процентах) **b\_date** - </p><p>Дата рождения клиента </p><p>**gifts** - массив с описанием доступных подарков для клиента **avgBill** - Средний чек **visitFrequency** - Частота визитов </p>|



|||<p>**visitCount** - Количество визитов </p><p>**totalAmount** - Сумма покупок </p><p>**maxPayBonusK** - % от заказа, который клиент может оплатить бонусами **sendReceiptToEmail** - клиент согласился получать чек на Email </p>|
| :- | :- | - |
|gift |Array |<p>Массив с описанием подарка, который хочет получить клиент: </p><p>**id\_gift** - ID подарка в системе GMB **id\_ext** - ID подарка в системе клиента **name** - Название подарка **description** - Описание подарка **price** - Стоимость подарка в баллах **active** - Признак активности ли подарка **can\_use** - Признак может ли клиент использовать подарок </p>|
|coupon |Array |<p>Массив с описанием купона, который хочет активировать клиент: </p><p>**id** - ID купона в системе GMB **id\_ext** - ID </p><p>подарка в системе клиента **name** - Название подарка **type -** Тип купона (*discount*) **data** - Массив свойств купона: *discountType* - Тип скидки (процент или фикс.) *discountValue* - Размер скидки </p><p>*minPayment* - Минимальная сумма к оплате после применения купона </p><p>**description** - Описание подарка </p><p>**price** - Стоимость купона в баллах </p><p>**active** - Признак активности купона </p><p>**can\_use** - Признак может ли клиент использовать купон </p>|
|stampcard |[array] |<p>Если подключен модуль для работы с штампкартами, то выдаётся информация о штампкарте пользователя. </p><p>Поля: **userStamps** - Накопленное покупателем количество штампов **stampsToReward** - Количество штампов для получения подарка </p><p>**isAssignedStamps** - Признак, что покупателю можно выдать подарок **title** - Заголовок штамп-карты </p>|

<a name="_page3_x33.00_y473.04"></a>BONUS 

Подтверждение оплаты заказа 

GMB рассчитывает количество бонусов, которые необходимо начислить клиенту основываясь на сумме заказа (поле **order\_price**). Если клиенту необходимо начислить произвольную сумму баллов её необходимо передать в параметре **bonus\_value. Если bonus\_value передан как 0, то клиенту не будут начислены баллы.** 

Если была частичная оплата заказа баллами - сумма баллов для списания передаётся в поле **paid\_bonus**. Сумма заказа(**order\_price**) передаётся без учёта оплаченных баллов. 

В случае выдачи подарка GMB ищет соответствие подарка в своей база с переданным составом чека по полю id\_product. В случае соответсвия с клиента будет списана сумма баллов равная стоимости подарка в баллах, указанная в  

кабинете GMB. 

URL запроса:  [*https://\[account\].getmeback.ru/rest/base/v33/validator/bonus* ](https://[account].getmeback.ru/rest/base/v33/validator/bonus)**Параметры запроса:** 



|**Ключ** |**Значение** |**Описание** ||
| - | - | - | :- |
|id\_branch |integer |ID филиала, в котором совершена операция ||
|id\_manager |integer |ID сотрудника, совершающего операцию ||
|manager\_name |string |Имя сотрудника, совершающего операцию ||
|branch\_name |string |Название филиала, в котором была совершена операция ||
|id\_client |integer |ID клиента ||
|id\_device |integer |ID устройства клиента ||
|order\_price |integer |Сумма заказа ||
|invoice\_num |string |Номер чека ||
|bonus\_value |[integer] |<p>Необязательное поле. Сумма баллов для начисления. </p><p>Если параметр передан - клиенту будет начислена переданная сумма баллов. Если не передан баллы будут рассчитаны на стороне GetMeBack исходя из суммы покупки </p>||
|paid\_bonus |integer | null |Сумма бонусов, использованных для оплаты заказа. Положительное число. Если клиент потратил 200 баллов, нужно прислать paid\_bonus: 200 ||
|operationDate |[DATE] |Дата операции в формате Y-m-d H:i:s Если параметр не передан, то будет использовано текущее время ||
|comment |[string] |Комментарий к операции ||
|return\_true\_if\_operati on\_exists |[boolean] |Проверка операции на дубль. Если параметр передан как true, то в ответа на запрос GetMeBack ||
|||<p>вернёт данные предыдущей операции, новая создана не будет. </p><p>Операция считается дублем если совпали следующие условия: ID клиента, ID филиала, номер чека. </p>||

Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]



|positions |Array | null |<p>Многомерный массив с составом заказа. **id\_product -** ID товара или артикул в система заказчика </p><p>**name** - Название </p><p>товара **qty** - количество </p><p>**price** - цена за единицу </p><p>**base\_price -** цена до применения акций **actions** - массив ID примененных акций </p><p>Если **id\_product** совпадает с полем “Внешний ID” в свойствах подарка GetMeBack определит выдачу подарка и спишет с клиента баллы </p>|
| - | - | :- |

**Возвращаемые значения:** 



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|result |ok | error |<p>Результат операции: </p><p>**ok** - операция прошла успешно **error** - произошла ошибка </p>|
|bonus\_value |integer |Сумма начисленных клиенту бонусов |
|bonus\_id |integer |Номер транзакции начисления баллов |
|client |Array |<p>Массив с описанием клиента: </p><p>**id\_client** - ID клиента </p><p>**id\_device** - ID устройства клиента **id\_ext** - Внешний ID клиента **name** - Имя клиента **phone** - Телефон клиента **balance** - Баланс бонусных баллов **k\_bonus** - коэффициент начисления бонусных </p><p>баллов(в процентах) **avgBill** - </p><p>Средний чек **visitFrequency** - </p><p>Частота визитов **visitCount** - </p><p>Количество визитов **totalAmount** </p><p>- Сумма покупок </p><p>**maxPayBonusK** - % от заказа, который клиент может оплатить бонусами **sendReceiptToEmail** - клиент согласился получать чек на Email </p><p>**b\_date** - Дата рождения клиента </p><p>**gifts** - массив с описанием доступных подарков </p>|

` `Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]

<a name="_page6_x33.00_y53.04"></a>GIFT 

Выдача подарка клиенту 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/gift* **Параметры запроса:** 



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|id\_branch |integer |ID филиала, в котором совершена операция |
|id\_manager |integer |ID сотрудника, совершающего операцию |
|manager\_name |string |Имя сотрудника, совершающего операцию |
|branch\_name |string |Название филиала, в котором была совершена операция |
|invoice\_num |string | null |Номер чека, необязательно |
|id\_client |integer |ID клиента |
|id\_device |integer |ID устройства клиента |
|id\_gift |integer |ID подарка, который хочет получить клиент |

**Возвращаемые значения:** 

|**Параметр** |**Значение** |**Описание** ||
| - | - | - | :- |
|result |ok | error |<p>Результат операции: </p><p>**ok** - операция прошла успешно **error** - произошла ошибка </p>||
|code |string |<p>Код ошибки </p><p>- **no\_client** - неверно передан ID клиента </p><p>- **gift\_disabled** - подарок не активен </p><p>- **small\_balance** - клиенту не хватает баланса </p><p>- **not\_available** - подарок не доступен клиенту </p>||
|gift |Array |<p>Массив с описанием выданного подарка: **id\_gift** - ID подарка **name** - </p><p>Название подарка **description** - Описание подарка **price** - </p><p>Стоимость подарка в бонусах </p>||
|client |Array |<p>Массив с описанием клиента: </p><p>**id\_client** - ID клиента </p><p>**id\_device** - ID устройства клиента </p><p>**name** - Имя клиента **phone** - Телефон клиента **balance** - Баланс бонусных баллов **k\_bonus** - коэффициент начисления бонусных баллов(в </p><p>процентах) </p>||
|||<p>**avgBill** - Средний чек </p><p>**visitFrequency** - Частота визитов </p><p>**visitCount** - Количество визитов </p><p>**totalAmount** - Сумма покупок </p><p>**sendReceiptToEmail** - клиент согласился получать чек на Email </p><p>**b\_date** - Дата рождения клиента </p><p>**gifts** - массив с описанием доступных подарков для </p>||

<a name="_page7_x33.00_y320.04"></a>COUPON 

Активация купона 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/coupon* **Параметры запроса:** 



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|id\_branch |integer |ID филиала, в котором совершена операция |
|id\_manager |integer |ID сотрудника, совершающего операцию |
|manager\_name |string |Имя сотрудника, совершающего операцию |
|branch\_name |string |Название филиала, в котором была совершена операция |
|invoice\_num |string | null |Номер чека, необязательно |
|id\_client |integer |ID клиента |
|id\_device |integer |ID устройства клиента |
|id\_coupon |integer |ID купона, который хочет активировать клиент |

**Возвращаемые значения:** 

|**Параметр** |**Значение** |**Описание** |
| - | - | - |
|result |ok | error |<p>Результат операции: </p><p>**ok** - операция прошла успешно **error** - произошла ошибка </p>|
|code |string |<p>Код ошибки </p><p>- **no\_client** - неверно передан ID клиента </p><p>- **coupon\_disabled** - купон не активен </p><p>- **small\_balance** - клиенту не хватает баланса </p><p>- **not\_available** - купон не доступен клиенту </p>|
|coupon |Array |Массив с описанием выданного подарка: **id** - ID подарка **name** - Название купона **description** - Описание купона **price** - Стоимость купона в бонусах |



|client |Array |<p>Массив с описанием клиента: </p><p>**id\_client** - ID клиента </p><p>**id\_device** - ID устройства клиента </p><p>**name** - Имя клиента **phone** - </p><p>Телефон клиента **balance** - </p><p>Баланс бонусных баллов **b\_date** - </p><p>Дата рождения клиента </p><p>**k\_bonus** - коэффициент начисления бонусных баллов(в процентах) **avgBill** - </p><p>Средний чек **visitFrequency** - </p><p>Частота визитов **visitCount** - </p><p>Количество визитов **totalAmount** </p><p>- Сумма покупок </p><p>**sendReceiptToEmail** - клиент согласился получать чек на Email </p>|
| - | - | - |

Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]

<a name="_page9_x33.00_y53.04"></a>CANCEL-OPERATION 

Отмена операции. Отмена может осуществляться либо по номеру чека, либо по номеру транзакции начисления баллов 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/cancel-operation* **Параметры запроса:** 

|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|invoice\_num |[string] |Номер чека |
|bonus\_id |[integer] |Номер транзакции начисления баллов |

**Возвращаемые значения:** 

|**Параметр** |**Значение** |**Описание** |
| - | - | - |
|status |ok | error |<p>Результат операции: </p><p>**ok** - Операция испешно отменена **error** - Произошла ошибка </p>|
|code |string |Код ошибки |

` `Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru 

![ref1]

<a name="_page10_x33.00_y53.04"></a>CHECK-GIFT 

Проверка доступен ли клиенту подарок 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/check-gift* **Параметры запроса:** 



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|id\_client |integer |ID клиента |
|id\_device |integer |ID устройства клиента |
|id\_gift |integer |ID подарка, который хочет получить клиент |

**Возвращаемые значения:** 

|**Параметр** |**Значение** |**Описание** |
| - | - | - |
|result |ok | error |<p>Результат операции: </p><p>**ok** - Клиенту доступен подарок **error** - Клиенту не может получить подарок </p>|
|code |string |Код ошибки |

Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]

<a name="_page11_x33.00_y53.04"></a>BRANCH-LIST 

Получение списка филиалов 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/branch-list* 

**Возвращаемые значение** 

|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|branch\_list |Array |<p>Массив со списком филиалов: </p><p>**id\_branch** - ID филиала </p><p>**name** - Название филиала </p><p>**address** - Адрес филиала </p><p>**is\_hidden** - Признак скрытого филиала **is\_active** - Признак закрытого филиала **managers** - Массив со списком сотрудников филиала: </p><p>**id\_manager** - ID менеджера **id\_user** </p><p>- ID пользователя системы **login** - </p><p>Логин пользователя в системе **name** </p><p>- Имя сотрудника </p>|

` `Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru 

![ref1]

<a name="_page12_x33.00_y53.04"></a>GIFT-LIST 

Получение списка всех подарков 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/gift-list* 

**Возвращаемые значение** 

|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|gift\_list |Array |<p>Массив со списком всех доступных </p><p>подарков: **id\_gift** - ИД подарка **name** - Название подарка **description** - Описание подарка </p><p>**price** - Стоимость подарка в бонусных баллах **active** - признак доступности подарка </p>|

<a name="_page12_x33.00_y315.04"></a>GET-USERS 

Получение списка всех клиентов 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/get-users* **Параметры запроса:** 



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|limit |integer |Количество возвращаемых записей |
|offset |integer |Смещение от начала возвращаемых значений(используется для постраничной выдачи) |
|phone|[string] |Номер телефона клиента в любом формате. Используется если нужно получить информацию по какому-то конкретному клиенту |
|id\_client|[integer] |Фильтр по ID клиента |
|date\_created|[DATE(YYYY-MM-DD)] |Фильтр по дате регистрации клиента |
|card\_num|[string] |Фильтр по номеру карты |
|add\_invoice\_sum|[boolean] |Добавить информацию о сумме покупок. Если параметр передан **true**, то к выдаче будет добавлено свойство **invoice\_sum** с суммой покупок клиента |

Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|meta |Array |<p>Сводная информация о запросе: **limit** </p><p>- ограничение для отдачи данных **offset** - сдвиг от начала списка **total** - общее количество записей </p>|
|users |Array[] |<p>Массив сущностей </p><p>пользователей **phone** - Телефон </p><p>клиента **name** - Имя клиента </p><p>**email** - Почта клиента **id\_client** - </p><p>ID Клиента </p><p>**id\_ext** - ID клиента в внешней системе **card\_num** - Номер карты клиента **gender** - Группа пользователя **birthday** - Дата рождения клиента **date\_created** - Дата регистрации клиента в формате *Y-m-d H:i:s* </p><p>**k\_bonus** - Процент начисления бонусов **balance** - Количество доступных </p><p>бонусов **avgBill** - Средний чек **visitFrequency** - Частота визитов **visitCount** - Количество визитов </p>|



|||<p>**totalAmount** - Сумма покупок </p><p>**balance\_delayed** - Количество отложенных бонусов **is\_blocked** - Признак, что пользователь заблокирован </p><p>**sendReceiptToEmail** - клиент согласился получать чек на Email </p>|
| :- | :- | - |

<a name="_page14_x33.00_y53.04"></a>CALCULATE-BONUS 

Расчет количества бонусов по сумме покупки 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/calculate-bonus* **Параметры запроса:** 



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|phone|[string] |Номер телефона клиента в любом формате. |
|id\_client|[integer] |ID клиента |
|card\_num|[string] |Карта клиента |
|id\_branch |integer |ID филиала, в котором совершена операция |
|branch\_name |string |Название филиала, в котором была совершена операция |
|paid\_bonus |[integer] |Количество баллов, которые клиент хочет потратить |
|to\_pay |integer |Сумма заказа |
|positions |Array | null |<p>Многомерный массив с составом заказа. **id\_product -** ID товара или артикул в системе заказчика </p><p>**name** - Название </p><p>товара **qty** - количество </p><p>**price** - цена за единицу </p><p>**actions** - массив id промоакций (оперирующих баллами), которые были применены к товару **action\_names** - массив названий промоакций (в формате id => название), которые были применены </p><p>Если в системе GetMeBack будет найден продукт по **id\_product,** то система определит максимальное кол-во бонусов, которое можно потратить на этот продукт, кол-во бонусов, которое можно начислить за этот продукт, а также вернет информацию о названии и цене товара в системе. Расчеты по бонусам производятся с учетом количества единиц товара в заказе. </p>|

Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|status |String |ok | error |
|bonus\_value |integer |Количество бонусов, которое будет начислено |



|||клиенту на переданную сумму чека |
| :- | :- | - |
|max\_use\_bonus |integer |Сколько баллов клиент может потратить для оплаты чека |
|products |Array |<p>Многомерный массив с информацией по каждому товару. </p><p>**id\_product -** ID товара или артикул в системе заказчика </p><p>**name** - название товара </p><p>**price** - цена товара </p><p>**quantity** - количество единиц товара **max\_pay\_bonus** - максимальное кол-во бонусов, которое можно потратить на этот продукт **earn\_bonus** - кол-во бонусов, которое можно начислить за этот продукт </p><p>**allow\_earn\_and\_pay** - разрешено ли начислять и списывать бонусы одновременно </p>|

<a name="_page16_x33.00_y53.04"></a>CALCULATE-PROMOTION 

Расчет акций по позициям в заказе. 

Метод принимает на вход список товаров из чека и применяет к нему акции. На выходе GetMeBack возвращает изменённый список товаров с примененными акциями. 

*Для применения акций все товары должны быть добавлены в заказ. Например, чтобы воспользоваться акцией “купи 2 пиццы получи 1 в подарок” в заказ должно быть добавлено 3 пиццы(см. пример запроса и ответа)*. 

URL запроса:[` `*https://\[account\].getmeback.ru/rest/base/v33/validator/calculate-promotion* ](https://[account].getmeback.ru/rest/base/v33/validator/calculate-promotion)* **Параметры запроса:** 



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|phone|[string] |Номер телефона клиента в любом формате. |
|id\_client|[integer] |ID клиента |
|card\_num|[string] |Карта клиента |
|id\_branch |string |ID филиала, в котором совершена операция |
|positions |Array | null |<p>Многомерный массив с составом заказа. **id\_product -** ID товара или артикул в системе заказчика </p><p>**name** - Название </p><p>товара **qty** - количество </p><p>**price** - цена за единицу </p>|

` `Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru 

![ref2]
**Возвращаемые значение** 
|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|status |String |ok | error |
|positions |Array |<p>Многомерный массив с информацией по каждому товару. </p><p>**id\_product -** ID товара или артикул в системе заказчика </p><p>**name** - название товара **price** - цена товара </p><p>**qty** - количество единиц товара **base\_price -** цена до применения акций **actions** - массив ID примененных акций **action\_names** - Массив названий сработавших акций </p>|
|info |Array |Одномерный массив с названиями примененных акций |

**Пример запроса:** 

{ ![](Aspose.Words.81ac4f07-46bc-4635-8829-ce88d217f8c6.004.png)

"id\_client": 10, 

"positions": [ 

{ 

"id\_product": "picca-01", "name": "Пицца", 

"qty": 3, 

"price": 500.00 

}, 

{ 

"id\_product": "cola-01", "name": "КулКола", "qty": 1, 

"price": 150.00 

} 

] 

} 

` `Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru 

![ref1]

**Пример ответа:** 

{ ![](Aspose.Words.81ac4f07-46bc-4635-8829-ce88d217f8c6.005.png)

"status": "ok", 

"positions": [ 

{ 

"id\_product": "picca-01", "name": "Пицца", 

"qty": 1, 

"price": 0, 

"base\_price": 500, "actions": [ 12 ] 

}, 

{ 

"id\_product": "cola-01", "name": "КулКола", "qty": 1, 

"price": 150, "base\_price": null, "actions": [] 

}, { 

"id\_product": "picca-01", "name": "Пицца", 

"qty": 2, 

"price": 500, "base\_price": null, "actions": [] 

} 

], 

"info": [ ![](Aspose.Words.81ac4f07-46bc-4635-8829-ce88d217f8c6.006.png)

"Применена акция: 3 пиццы по цене 2х" ] 

} 

Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]

<a name="_page19_x33.00_y53.04"></a>BONUS-LIST 

История начисления и списания бонусных баллов 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/bonus-list* **Параметры запроса:** 

|**Ключ** |**Значение** ||**Описание** |
| - | - | :- | - |
|date\_start |DATE(YYYY-MM-DD) NULL || |Начала периода для выгрузки |
|date\_end |DATE(YYYY-MM-DD) NULL || |Конец периода для выгрузки |
|id\_branch |integer | NULL ||ID филиала |
|id\_manager |integer | NULL ||ID сотрудника |
|id\_gift |integer | NULL ||ID подарка |
|id\_client |integer | NULL ||ID клиента |
|id\_device |integer | NULL ||ID устройства |
|limit |integer | NULL ||Количество записей выгрузки |

**Возвращаемые значение** 



|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|bonus\_list |Array |<p>Массив операций с бонусными баллами **id\_bonus** - ID операции </p><p>**value** - сумма начисленных или списанных баллов </p><p>**order\_price** - сумма покупки </p><p>**invoice\_num** - Номер чека </p><p>**date** - Дата операции </p><p>**branch** - Массив с описанием филиала, в котором была совершена операция </p><p>**client** - Массив свойств клиент **manager** - Массив свойств сотрудника, выполнившего операции </p><p>**gift** - Массив свойств подарка, если был выдан </p>|

**Пример ответа API:** 

` `Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru 

![ref1]

{ ![](Aspose.Words.81ac4f07-46bc-4635-8829-ce88d217f8c6.007.png)

"bonus\_list": [ 

{ 

"id\_bonus": "819", 

"value": "70", 

"order\_price": "1400.00", "invoice\_num": "0", 

"date": "2018-12-01 22:10:49", "branch": { 

"id\_branch": "2", 

"name": "Магазин на Гагарина" }, 

"client": { 

"id\_client": "3", 

"id\_device": "1", 

"name": "Журавлев Павел", "login": "79022836785" 

}, 

"manager": { 

"id\_manager": "2", 

"name": "Администратор", "login": "demo" 

}, 

"gift": [] 

}, ... 

{ 

"id\_bonus": "825", 

"value": "-169", 

"order\_price": "0.00", "invoice\_num": "0", 

"date": "2018-12-06 14:32:54", "branch": { 

"id\_branch": "1", 

"name": "Магазин на Мира 12" }, 

"client": { 

"id\_client": "0", 

"id\_device": "0", 

"name": "Гость", 

"login": "Guest" 

}, 

"manager": { 

"id\_manager": "2", 

"name": "Администратор", "login": "demo" 

}, 

Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]

"gift": { ![](Aspose.Words.81ac4f07-46bc-4635-8829-ce88d217f8c6.008.png)

"id\_gift": "1", 

"name": "Куриный рулет", "price": "169" 

} } 

] } 

<a name="_page21_x33.00_y192.04"></a>CLIENT-MIGRATION 

Миграция клиентов и бонусов 

Метод ищет в базе GetMeBack клиента с номером телефона, переданным в phone. Если клиент найден - ему будет начислена переданная сумма баллов. Если клиент не найден он будет добавлен в специальный реестр миграций. Баллы клиенту в данному случае будут начислены только тогда, когда клиент установит приложение и зарегистрируется в нём. 

- Если передать ***client\_id\_ext,*** то при регистрации клиента ему будет присвоен указанный внешний ID. Если клиент уже зарегистрирован, ему будет присвоено переданное значение. Если значение уже было присвоено, оно будет заменено новым 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/client-migration* **Параметры запроса:** 

|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|phone invoice invoice\_num invoice\_date bonus\_value client\_name client\_bday client\_id\_ext |<p>string </p><p>integer </p><p>string </p><p>date[ГГГГ-ММ-ДД ЧЧ:ММ:СС] integer </p><p>[string] </p><p>[date[ГГГГ-ММ-ДД]] </p><p>[string] </p>|<p>Телефон клиента </p><p>Сумма чека </p><p>Номер чека </p><p>Дата операции </p><p>Сумма начисленных бонусов Имя клиента </p><p>Дата рождения клиента </p><p>ID клиента в внешней системе </p>|

**Возвращаемые значения:** 

|**Параметр** |**Значение** |**Описание** |
| - | - | - |
|status |ok | error |<p>Результат операции: </p><p>**ok** - Операция испешно отменена **error** - Произошла ошибка </p>|

` `Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru 

![ref1]



|code |string |<p>Код ошибки </p><p>- **bad\_phone** - Неверный формат телефона клиента </p><p>- **bonus** - Клиент найден в базе GMB и ему начислены бонусы </p><p>- **migration** - клиент добавлен в реестр миграций </p>|
| - | - | - |

Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]

<a name="_page23_x33.00_y53.04"></a>ADD-STAMPS 

Данный метод API используется для начисления штампов покупателю. URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/add-stamps* **Параметры запроса:** 

|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|id\_branch |integer |ID филиала, в котором совершена операция |
|id\_manager |integer |ID сотрудника, совершающего операцию |
|manager\_name |string |Имя сотрудника, совершающего операцию |
|branch\_name |string |Название филиала, в котором была совершена операция |
|id\_client |integer |ID клиента |
|stamps |integer |Количество штампов для начисления. Количество штампов покупателя не должно превышать количество штампов для выдачи подарка |

**Возвращаемые значения:** 

|**Параметр** |**Значение** |**Описание** |
| - | - | - |
|status |ok | error |<p>Результат операции: </p><p>**ok** - Операция испешно отменена **error** - Произошла ошибка </p>|
|code |string |<p>Код ошибки </p><p>- **no\_client** - Клиент не найден </p><p>- **wrong\_stamps** - Передано неверное количество штампов </p><p>- **stamps\_exceeded** - Покупателю не может быть начислено столько штамов </p>|

` `Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru 

![ref2]

<a name="_page24_x33.00_y53.04"></a>GIFT-FOR-STAMPS 

Данный метод API используется для подтверждения факта выдачи подарка покупателю. URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/gift-for-stamps* **Параметры запроса:** 

|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|id\_branch |integer |ID филиала, в котором совершена операция |
|id\_manager |integer |ID сотрудника, совершающего операцию |
|manager\_name |string |Имя сотрудника, совершающего операцию |
|branch\_name |string |Название филиала, в котором была совершена операция |
|id\_client |integer |ID клиента |

**Возвращаемые значения:** 

|**Параметр** |**Значение** |**Описание** |
| - | - | - |
|status |ok | error |<p>Результат операции: </p><p>**ok** - Операция испешно отменена **error** - Произошла ошибка </p>|
|code |string |<p>Код ошибки </p><p>- **no\_client** - Клиент не найден </p><p>- **no\_stamps** - Клиенту не хватает штампок </p>|

Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]

<a name="_page25_x33.00_y53.04"></a>FIND-BONUS 

Данный метод API позволяет найти операции с баллами 

URL запроса: *https://[account].getmeback.ru/rest/base/v33/validator/find-bonus* **Параметры запроса:** 

|**Ключ** |**Значение** |**Описание** |
| - | - | - |
|id\_branch |integer |ID филиала, в котором совершена операция |
|id\_client |integer |ID покупателя, которому были начислены баллы |
|invoice\_num |string |Номер чека |
|date\_from |date(Y-m-d H:i:s) |Время начала выборки (MSK) |
|date\_to |date(Y-m-d H:i:s) |Конец выборки. По умолчанию дата на текущий момент. |

**Возвращаемые значения:** 

|**Параметр** |**Значение** |**Описание** |
| - | - | - |
|status |ok | error |<p>Результат операции: </p><p>**ok** - Операция испешно отменена **error** - Произошла ошибка </p>|
|date\_from |date(Y-m-d H:i:s) |Время начала выборки (MSK) |
|date\_to |date(Y-m-d H:i:s) |Конец выборки (MSK) |
|bonus |arra |<p>Массив найденых операци, где: **id\_bonus** - ID Операции в GetMeBack **id\_client** - ID Покупателя **id\_branch** - ID Торговой точки **phone** - Телефон клиента **invoice\_num** - Номер чека **receipt** - Массив товаров из заказа, где *art* - Артикул товара *price* - цена товара *qty* - количество товара **operation\_date** - Дата операции </p><p>**paid** - оплачено </p><p>**paid\_by\_bonus** - Потрачено баллов **bonus\_value** - Начислено баллов </p>|

` `Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru 

![ref1]

История изменений

v3.3: 

- Добавлена поддержка дробных значений в методе BONUS 
- Убрано игнорирование ошибок в методе BONUS 

09\.06.2022 

- Добавлен параметр **add\_invoice\_sum** к методу **GET-USERS**

01\.11.2022

- Добавлен метод COUPON
- В метод /code добавлен новый тип кода coupon

08\.12.2022

- Добавлен признак пользователя **sendReceiptToEmail** - клиент согласился получать чек на Email 

11\.07.2022 

- В методах **/code /bonus /gift /coupon /get-users** обновлена информация о покупателе. Добавлены следующие свойства: 
- **avgBill** - Средний чек 
- **visitFrequency** - Частота визитов 
- **visitCount** - Количество визитов 
- **totalAmount** - Сумма покупок 

27\.10.2023 

- В метод /code добавлена информация о штамп-карте покупателя 
- Добавлен метод ADD-STAMPS 
- Добавлен мтод GIFT-FOR-STAMPS 

30\.05.2024 

- Добавлен метод FIND-BONUS 

28\.10.2024 

- В метод /bonus добавлены следующие параметры: 
- **operationDate** - Дата операции 
- **comment** - Комментарий к операции 
- **return\_true\_if\_operation\_exists** - Проверка операции на дубль 
Тех. Поддержка с 8:00 до 20:00 по МСК по рабочим дням +7 (812) 407-27-85 WhatsApp или телефон, телеграм @getmeback\_support, support@getmeback.ru ![ref1]

[ref1]: Aspose.Words.81ac4f07-46bc-4635-8829-ce88d217f8c6.002.png
[ref2]: Aspose.Words.81ac4f07-46bc-4635-8829-ce88d217f8c6.003.png
