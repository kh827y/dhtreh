'use client';
import Link from 'next/link';

export default function RotationDocs() {
  return (
    <main style={{ maxWidth: 880, margin: '40px auto', fontFamily: 'system-ui, Arial' }}>
      <h1>Ротация ключей (Webhooks / Bridge / QR)</h1>
      <p>
        Система поддерживает бесшовную ротацию секретов для подписи вебхуков и запросов Bridge,
        а также ротацию секрета для QR‑JWT токенов. В админке у мерчанта доступны поля текущего и
        следующего секрета с идентификаторами (Key ID, kid).
      </p>
      <h3>Webhooks</h3>
      <ol>
        <li>Сгенерируйте <b>Webhook Secret (next)</b> и укажите <b>Webhook Key ID (next)</b> в настройках.</li>
        <li>На стороне получателя вебхука добавьте поддержку проверки подписи по новому kid.</li>
        <li>Включите флаг <b>Use next</b> — сервер начнёт подписывать ответы/вебхуки новым ключом, отправляя <code>X-Signature-Key-Id</code>.</li>
        <li>После переходного периода перенесите <b>next</b> в основные поля и очистите <b>next</b>.</li>
      </ol>
      <p>Подпись: HMAC_SHA256(ts + '.' + body), заголовок <code>X-Loyalty-Signature</code>. Ключ выбирается по kid.</p>

      <h3>Bridge подпись</h3>
      <p>
        Если включено требование подписи Bridge — сервер принимает подпись по текущему и <i>следующему</i> секрету
        (fallback). Это позволяет прокатить новый секрет заранее. Для устройств можно выдавать секрет отдельно.
      </p>

      <h3>QR‑JWT</h3>
      <p>
        Для QR‑JWT в API поддержан мягкий переход: при верификации сначала используется <code>QR_JWT_SECRET</code>, затем
        при неуспехе — <code>QR_JWT_SECRET_NEXT</code>. В заголовок токена помещается <code>kid</code> (если задан
        <code>QR_JWT_KID</code>), что упрощает трекинг смены ключей.
      </p>

      <h3>Рекомендации</h3>
      <ul>
        <li>Держите активными оба секрета в период ротации. Сверяйте по kid и времени.</li>
        <li>Планируйте ротацию раз в 60–90 дней или при подозрении на компрометацию.</li>
        <li>Для Bridge храните секрет на устройстве и регулярно перевыдавайте через админку.</li>
      </ul>

      <div style={{ marginTop: 12 }}>
        <Link href="/">← Настройки</Link>
      </div>
    </main>
  );
}

