# Аудит: admin login и admin auth

Ниже перечислены проблемы, отсортированные по убыванию важности устранения.

## P1 — Высокая важность

### 1) Нет защиты от брутфорса/перебора пароля на `/api/auth/login`
- **Риск:** админ‑доступ завязан на один пароль (`ADMIN_UI_PASSWORD`), при отсутствии лимитов/замедления подбор становится реальным в проде (особенно при утечке пароля или использовании слабого пароля).
- **Где:** `admin/app/api/auth/login/route.ts` (принимает пароль/OTP, но не ограничивает частоту и не вводит задержки/блокировки).
- **Почему важно:** это прямой вектор захвата админки, критично для продакшена даже при небольшом числе клиентов.

## P2 — Средняя важность

### 2) Middleware проверяет только наличие cookie, но не валидирует подпись/срок
- **Риск:** любой может подставить любой `admin_session_v1` и получить доступ к UI‑страницам админки (даже с истёкшей/поддельной сессией). В результате UI может открываться без реальной авторизации; реальные данные не будут доступны из‑за защиты API, но поведение вводит в заблуждение и повышает риск социальной инженерии.
- **Где:** `admin/middleware.ts` (проверка только `if (!cookie)` без `verifySessionCookie`).
- **Почему важно:** для прод‑норм корректнее валидировать сессию в middleware, чтобы сразу отсекать поддельные/просроченные cookie и не показывать админ‑UI без входа.

## P3 — Низкая важность

### 3) UI раскрывает диагностические сообщения конфигурации
- **Риск:** при ошибках входа UI отображает текст ошибки целиком (`Admin UI password not configured`, `Admin password not properly configured for production`), что раскрывает внутренние детали конфигурации и может облегчить атакующему диагностику окружения.
- **Где:** `admin/app/login/page.tsx` (выводит `e.message`), `admin/app/api/auth/login/route.ts` (возвращает подробные строки ошибок).
- **Почему важно:** это не блокер, но для продакшн‑норм лучше отдавать нейтральные сообщения пользователю и логировать детали на сервере.
