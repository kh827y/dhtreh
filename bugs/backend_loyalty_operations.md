# Аудит: логи операций лояльности (GET /portal/loyalty/operations)

## P1 — High

### 1) Логи механик фактически никогда не пишутся → раздел `MECHANIC` всегда пустой
- **Почему это важно:** интерфейс/аналитика будут показывать отсутствие операций по механикам даже при реальных изменениях; аудит изменений механик невозможен.
- **Причина:** в коде есть таблица `LoyaltyMechanicLog` и чтение из неё в `operationsLog`, но отсутствуют любые записи в эту таблицу при создании/обновлении/смене статуса/удалении механик.
- **Где видно:** `operationsLog` читает `loyaltyMechanicLog`, а методы `createMechanic/updateMechanic/changeMechanicStatus/deleteMechanic` логируют только в `logger` и метрики, без записи в `LoyaltyMechanicLog`.
- **Риск:** неполный журнал действий + несоответствие ожиданиям “операций лояльности”.

### 2) Журнал обрезается до 200 записей на тип без пагинации/total → неполные данные без предупреждения
- **Почему это важно:** при активных акциях/промокодах журнал операций будет показывать лишь “хвост”, скрывая старые операции и создавая ложное ощущение отсутствия действий.
- **Причина:** в `operationsLog` используется `take: 200` для каждого типа, но нет параметров `limit/offset` и нет `total` для контроля полноты.
- **Риск:** менеджер видит неполную картину, а аналитика/проверка начислений становятся ненадёжными.

## P2 — Medium

Нет актуальных пунктов.

## P3 — Low

### 5) Спецификация API не описывает параметры эндпоинта
- **Почему это важно:** интеграторам/фронтенду сложно корректно использовать фильтры.
- **Причина:** в `openapi.generated.json` у `/portal/loyalty/operations` нет описания параметров `type/from/to`, хотя они используются в контроллере.
- **Риск:** повышенная нагрузка на поддержку и ошибки использования.
