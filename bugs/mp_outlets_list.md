# Аудит merchant-portal: список торговых точек (/portal/outlets)

## P1 — Критично

Нет актуальных пунктов.

## P2 — Высокий приоритет

### 2) Дублируются контроллеры на одном и том же маршруте `/portal/outlets`
- **Где**: 
  - `api/src/portal/portal.controller.ts` (`@Controller('portal')` → `GET/POST/PUT/DELETE /portal/outlets`),
  - `api/src/merchant-panel/controllers/outlets.controller.ts` (`@Controller('portal/outlets')`).
- **Что не так**:
  - Два контроллера регистрируют **одни и те же URL**. В NestJS порядок обработки может быть неочевидным → на проде реально может отвечать «не тот» контроллер.
  - Контроллеры возвращают **разные форматы**: `PortalController` даёт `{ items, total }`, а `OutletsController` — `{ items, meta }` с пагинацией по умолчанию (pageSize=20). Порядок сортировки тоже разный (`asc` vs `desc`).
- **Риск**: список точек в портале может показывать не те данные, ограничиваться первой страницей или внезапно менять сортировку/количество без изменений в UI.
- **Что делать**: оставить один каноничный контроллер для `/portal/outlets`, второй убрать или переименовать под другой namespace.

### 3) UI не учитывает пагинацию и `total`, поэтому список и счётчики могут быть некорректными
- **Где**: `merchant-portal/app/outlets/page.tsx`.
- **Что не так**:
  - UI берёт счётчики только из `activeOutlets.length`/`inactiveOutlets.length`.
  - Если фактически отвечает `OutletsController` (или в будущем добавится пагинация), то возвращается **только первая страница** (20 элементов), а `total`/`meta.total` игнорируется.
- **Риск**: для мерчанта с большим числом точек UI показывает неполные списки и заниженные счётчики.
- **Что делать**: читать `total`/`meta.total` и либо запрашивать все страницы, либо реализовать пагинацию/«показать ещё».
