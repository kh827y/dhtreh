# Аудит: карточка сотрудника (merchant-portal)

Ниже перечислены найденные проблемы по убыванию критичности.

## Критично / безопасность

1. **PIN-коды кассира доступны любому сотруднику с правом `staff:read`.**
   - UI и API отдают `pinCode` для каждой торговой точки (`/portal/staff/:id/access`), а `PortalGuard` для `GET /portal/staff*` требует только действие `read`. Это означает, что даже аналитик/менеджер с правом чтения может получить PIN другого сотрудника и войти в кассовый режим, что ведёт к возможности подмены операций/абуза баллов.
   - Нужно либо скрывать/маскировать PIN в ответе, либо требовать отдельного права (например, `staff:manage`/`cashier:manage`) для доступа к PIN-кодам, либо вообще вынести PIN в отдельный защищённый эндпоинт.

## Высокая важность

2. **После отзыва доступа к торговой точке её нельзя повторно назначить через интерфейс.**
   - Бэкенд `GET /portal/staff/:id/access` возвращает и активные, и отозванные доступы. UI фильтрует список доступных точек по самому факту наличия `outletId` в доступах, не учитывая `status`. В итоге отозванная точка продолжает считаться «занятой» и не отображается в выборе при добавлении.
   - Это блокирует повторную выдачу доступа без прямого вмешательства в БД/ручных запросов.

3. **Статус доступа не отображается, и UI продолжает показывать PIN для отозванной точки.**
   - В карточке сотрудника нет явного отображения `status` доступа, хотя в данных он присутствует. При статусе `REVOKED` пользователь всё равно видит PIN-код, что вводит в заблуждение и создаёт ложное ощущение активности доступа.
   - Нужна маркировка статуса (например, «доступ отозван»), скрытие PIN или отдельный экран/фильтр «архивных» доступов.
