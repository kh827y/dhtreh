# Аудит backend_portal_api

Ниже перечислены проблемы по убыванию важности.

## Высокий приоритет

### 1) Неверная фильтрация торговых точек по статусу (ACTIVE/INACTIVE)
- **Симптом**: UI отправляет `status=ACTIVE|INACTIVE`, а backend ожидает только `active|inactive`. В результате фильтр по статусу фактически игнорируется и возвращается список «all», что ломает аудитории и выбор точек в интерфейсе.
- **Где проявляется**:
  - `GET /portal/outlets` принимает только `active|inactive`.
  - В `merchant-portal` используются запросы `/api/portal/outlets?status=ACTIVE|INACTIVE` (страницы аудиторий/списка точек).
- **Риск**: пользователь видит/выбирает неверный набор точек → неверные сегменты, кампании и настройки.
- **Рекомендация**: привести статусы к единому регистру (backend: case-insensitive нормализация, UI: отправлять `active|inactive`).

### 2) Импорт клиентов: нет ограничений на размер файла
- **Симптом**: `POST /portal/customers/import` использует `FileInterceptor` без лимитов размера/типа.
- **Риск**: возможность загрузить очень большой файл и положить процесс API по памяти (DoS), особенно при одновременных загрузках.
- **Рекомендация**: добавить ограничения по размеру (например 10–20 МБ) и базовую валидацию типа/формата до обработки.

## Средний приоритет

### 3) Некорректные даты в `/portal/transactions|receipts|ledger` приводят к 500
- **Симптом**: параметры `from/to/before` парсятся через `new Date(...)` без проверки `isNaN()`. При некорректной дате Prisma получает `Invalid Date` и возвращает 500.
- **Риск**: нестабильность API при ошибках клиента/браузера, отсутствие понятной ошибки для пользователя.
- **Рекомендация**: валидировать даты и возвращать 400 с явным сообщением об ошибке.

