# Аудит: повторные продажи (merchant-portal)

## P1 — Высокий приоритет

- **[Аналитика] Фильтр торговой точки не применяется к метрике «Новые покупатели».**
  - UI отправляет `outletId` при выборе точки, а backend применяет фильтр только в запросе по покупкам/повторным покупателям.
  - Для «Новых покупателей» используется отдельный запрос без фильтра по `outletId`, из‑за чего KPI может показывать значения по всем точкам и расходиться с «Уникальными покупателями»/гистограммой при включённом фильтре.
  - Результат: недостоверная аналитика по точкам, риск неверных управленческих решений.

## P2 — Средний приоритет

- **[UI/Аналитика] Нельзя посмотреть аналитику по неактивным (архивным) торговым точкам.**
  - На странице загружаются только активные точки (`/api/portal/outlets?status=active`).
  - Backend поддерживает `status=all|inactive`, но UI не даёт выбрать архивные точки для ретроспективного анализа.
  - Результат: потеря исторической аналитики после закрытия точки.

## P3 — Низкий приоритет

- **[Docs/API] OpenAPI для `/portal/analytics/repeat` помечает `period/from/to/outletId` как обязательные, хотя в реальном коде они опциональны.**
  - В контроллере параметры `period/from/to/outletId` необязательны, а UI отправляет только `period` (и `outletId` при выборе).
  - Результат: несоответствие документации/клиентов реальному контракту.
