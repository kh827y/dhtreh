# Аудит настроек системы (merchant-portal /portal/settings)

## Высокий приоритет
1. **Слишком широкий доступ к данным настроек через `/portal/settings`.**
   - Сейчас `PortalController.assertSettingsReadAccess` разрешает читать `/portal/settings` любому сотруднику с правом **read** на _любую_ из перечисленных зон (`system_settings`, механики, antifraud, integrations и т.д.). В итоге пользователь с минимальным доступом (например, только к антифроду или интеграциям) получает весь набор системных настроек, включая параметры начислений/лимитов и другие чувствительные бизнес‑данные, которые ему не нужны.
   - Это нарушение разграничения доступа и риск утечки бизнес‑логики/конфигурации. Правильнее либо дробить `/portal/settings` на узкие эндпоинты, либо фильтровать поля по правам, либо требовать `system_settings` для чтения полного объекта.

## Средний приоритет
1. **Список часовых поясов в UI захардкожен и не синхронизирован с backend‑опциями.**
   - В `merchant-portal/app/settings/system/page.tsx` используется статический массив `timezones`, хотя backend отдаёт актуальные `options` через `/portal/settings/timezone` (и они уже доступны через `TimezoneProvider`).
   - При добавлении/изменении таймзон на сервере UI не обновится: пользователь не сможет выбрать новые зоны, а при несовпадении текущего кода со списком — селект окажется «пустым» или принудительно сбросится на первый элемент.

2. **Несогласованные дефолты `earnBps` при отсутствии записи настроек.**
   - `MerchantsService.getSettings()` при отсутствии `merchant.settings` подставляет `earnBps: 300`, тогда как дефолт в БД (`MerchantSettings.earnBps`) и `updateTimezone` при создании записи — `500`.
   - Это приводит к разным «стартовым» процентам начисления в зависимости от того, через какой путь впервые создаётся запись настроек. Для новых мерчантов может неожиданно получиться 3% вместо 5% (или наоборот), что влияет на финансы и ожидания пользователей.
