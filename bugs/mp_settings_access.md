# Аудит: настройки доступа (merchant-portal)

## Высокая важность

1. **Редактирование участников группы может «случайно» удалить сотрудников из группы.**
   - В `merchant-portal/app/settings/access/page.tsx` список сотрудников для группы строится из `/api/portal/staff` без `pageSize`, поэтому API возвращает только первую страницу (по умолчанию 20). При сохранении группа перезаписывается запросом `POST /portal/access-groups/:id/members` с `staffIds` из этой ограниченной выборки.
   - Итог: если в группе больше 20 сотрудников, то все, кто не попал в первую страницу, будут удалены из группы при любом сохранении прав (даже если вы не трогали список участников). Это фактически массовый отзыв доступа и риск простоя работы.
   - Затрагивает связку: UI `settings/access` → `merchant-portal/app/api/portal/staff/route.ts` → `api/src/merchant-panel/controllers/staff.controller.ts` → `api/src/merchant-panel/merchant-panel.service.ts` (pagination + `setGroupMembers`).

## Средняя важность

2. **Отсутствует управление доступом к странице “Wallet”, хотя меню завязано на ресурс `wallet`.**
   - В `merchant-portal/app/layout.tsx` для пути `/wallet` требуется право `wallet: read`, но в `merchant-portal/app/settings/access/page.tsx` нет секции `wallet`.
   - Итог: невозможно выдать доступ к Wallet точечно. Администратору приходится давать «полный доступ», что избыточно для малого бизнеса и увеличивает риск ошибок.

3. **Экран настроек групп доступа не распознаёт отсутствие backend‑поддержки и предлагает действия, которые гарантированно падают.**
   - Если `/portal/access-groups` возвращает 404, `merchant-portal/app/api/portal/access-groups/route.ts` подставляет фолбэк‑список. Но UI всё равно показывает создание/редактирование/удаление и пытается вызвать `POST/PUT/DELETE /portal/access-groups`, которые в legacy‑режиме не работают.
   - Итог: пользователь видит «живой» интерфейс, но операции не выполняются (ошибки при сохранении), что воспринимается как баг/нестабильность.

