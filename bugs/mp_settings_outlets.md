# Аудит merchant-portal: настройки торговых точек (/settings/outlets, /outlets) и /portal/outlets

## P1 — Высокая

1. **Удаление торговой точки — жёсткий `DELETE` без безопасной деактивации/архивации и без проверки зависимостей.**
   - В UI есть кнопка «Удалить», которая вызывает `DELETE /api/portal/outlets/:id`, а backend делает прямой `prisma.outlet.delete`. Это либо ломается из‑за FK (транзакции/чеки/другие сущности), либо приводит к потере истории, если каскады включены.
   - Риск: реальные точки с историей продаж невозможно удалить (ошибка без понятного сообщения), либо случайно удалить исторические данные, что критично для продакшена.
   - Где смотреть: `merchant-portal/app/outlets/page.tsx` (кнопка удаления), `merchant-portal/app/api/portal/outlets/[id]/route.ts`, `api/src/portal/portal.controller.ts`, `api/src/merchants/merchants.service.ts`, связи `Outlet` в `api/prisma/schema.prisma`.

## P2 — Средняя

1. **В форме создания/редактирования точки отсутствуют важные поля, которые уже поддерживаются backend.**
   - В портале можно менять только название, статус, устройства и ссылки на отзывы, но нет адреса, телефона, таймзоны, расписания, координат, внешнего ID и т.п., хотя эти поля есть в `PortalOutletDto` и в модели `Outlet`.
   - Риск: точки, созданные через портал, остаются «неполными», что ломает сценарии, где используются адрес/расписание/геолокация/интеграции (например, отображение в других интерфейсах или в интеграциях).
   - Где смотреть: `merchant-portal/app/outlets/new/page.tsx`, `merchant-portal/app/outlets/[id]/page.tsx`, `api/src/portal/catalog.service.ts` (`mapOutlet`, `createOutlet`, `updateOutlet`), `api/prisma/schema.prisma`.

2. **Список сотрудников точки ограничен 100 записями без пагинации, а отображаемое количество вводит в заблуждение.**
   - В карточке точки делается запрос `/api/portal/staff?outletId=...&pageSize=100`, а счётчик берётся как `staff.length`. При 100+ сотрудниках пользователь не видит всех и считает, что их ровно 100.
   - Риск: некорректные данные в UI и невозможность проверить/найти сотрудников в крупных точках.
   - Где смотреть: `merchant-portal/app/outlets/[id]/page.tsx`.

## P3 — Низкая

1. **Страница настроек `/settings/outlets` переиспользует `/outlets`, но действия уводят из раздела настроек.**
   - Обёртка `SettingsOutletsWrapper` рендерит `OutletsPage`, а все переходы (`Добавить точку`, `Редактировать`) ведут на `/outlets/*`.
   - Риск: пользователь теряет контекст «Настроек» (меню/хлебные крошки), что ухудшает UX.
   - Где смотреть: `merchant-portal/app/settings/outlets/page.tsx`, `merchant-portal/app/outlets/page.tsx`.
