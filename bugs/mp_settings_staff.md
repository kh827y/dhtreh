# Аудит: настройки персонала и группы доступа (merchant-portal)

## Критично
1. **Не работает сохранение состава группы доступа из-за неверного импорта в API-роуте.**
   В `merchant-portal/app/api/portal/access-groups/[id]/members/route.ts` импортируется `portalFetch` из несуществующего пути `../../../../portal/_lib`, поэтому роут `/api/portal/access-groups/{id}/members` падает при сборке/запуске. В итоге кнопка сохранения состава группы не сможет отправить изменения — управление доступами фактически блокируется.

## Высокий приоритет
1. **Редактирование групп доступа работает только с первыми ~20 сотрудниками и может удалять остальных.**
   Экран настроек групп доступа грузит список сотрудников через `fetch("/api/portal/staff")` без `pageSize`, а API по умолчанию возвращает только 20 записей. Далее этот неполный список используется для вычисления `staffIds` у групп и отправляется обратно при сохранении. Итог: сотрудники вне первой страницы не отображаются в селекте, а при сохранении состава группы они «выпадают» из группы (данные перезаписываются неполным списком).

## Средний приоритет
1. **Фильтр «С доступом в панель» и счётчик `portalEnabled` расходятся с фактическим доступом.**
   Фронтенд считает доступ по `portalAccessEnabled || canAccessPortal`, но бэкенд-фильтр `portalOnly` и счётчик `portalEnabled` учитывают только `portalAccessEnabled`. Если данные несинхронны (например, legacy/ручные изменения), часть сотрудников с доступом будет скрыта фильтром и не попадёт в счётчик.
