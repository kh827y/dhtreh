# API (NestJS)
NODE_ENV=production

# Database
# Use together with docker-compose.production.yml: DB_PASSWORD is referenced
DB_PASSWORD=change_me_db
DATABASE_URL=postgresql://loyalty:${DB_PASSWORD}@postgres:5432/loyalty

# Redis (optional but recommended)
REDIS_PASSWORD=change_me_redis
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379

# Core secrets
ADMIN_KEY=change_me_admin_key
QR_JWT_SECRET=change_me_qr_secret
ADMIN_SESSION_SECRET=change_me_session_secret
PORTAL_JWT_SECRET=change_me_portal_jwt_secret
PORTAL_REFRESH_SECRET=change_me_portal_refresh_secret

# Public origins and base URLs (adjust DOMAIN)
DOMAIN=example.com
CORS_ORIGINS=https://admin.${DOMAIN},https://cashier.${DOMAIN},https://app.${DOMAIN}
API_BASE_URL=https://api.${DOMAIN}
MINIAPP_BASE_URL=https://app.${DOMAIN}

# Observability (optional)
SENTRY_DSN=
SENTRY_TRACES_SAMPLE_RATE=0.0
OTEL_ENABLED=0
METRICS_TOKEN=
ALERTS_5XX_SAMPLE_RATE=0.0

# Alerts (optional)
ALERT_TELEGRAM_BOT_TOKEN=
ALERT_TELEGRAM_CHAT_ID=
ALERT_OUTBOX_PENDING_THRESHOLD=200
ALERT_OUTBOX_DEAD_THRESHOLD=5
ALERT_WORKER_STALE_MINUTES=5
ALERT_MONITOR_INTERVAL_MS=60000
ALERT_REPEAT_MINUTES=30

# Telegram (global fallback; per-merchant tokens are preferred via Admin UI)
TELEGRAM_BOT_TOKEN=
TELEGRAM_BOT_USERNAME=

# Idempotency TTL (hours)
IDEMPOTENCY_TTL_HOURS=72

# Workers
WORKERS_ENABLED=0
NO_HTTP=0
# Auto-return mechanic (interval in ms, batch size per tick)
# AUTO_RETURN_WORKER_INTERVAL_MS=21600000
# AUTO_RETURN_BATCH_SIZE=200
# Feature flags
EARN_LOTS_FEATURE=0
POINTS_TTL_FEATURE=0
POINTS_TTL_BURN=0
TTL_BURN_ENABLED=0
POINTS_TTL_REMINDER=0
# POINTS_TTL_REMINDER_INTERVAL_MS=21600000
# OUTBOX_WORKER_CONCURRENCY=3
# OUTBOX_MAX_RETRIES=10
# OUTBOX_HTTP_TIMEOUT_MS=10000
# OUTBOX_CB_THRESHOLD=5
# OUTBOX_CB_WINDOW_MS=60000
# OUTBOX_CB_COOLDOWN_MS=120000
# OUTBOX_RPS_DEFAULT=0
# OUTBOX_RPS_BY_MERCHANT="M-1=5,M-2=3"

# Notifications (optional)
# SMTP
SMTP_HOST=
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM=

# Push (FCM)
# Set FIREBASE_SERVICE_ACCOUNT to JSON string with service account
FIREBASE_SERVICE_ACCOUNT=

# Notification worker (optional)
# NOTIFY_WORKER_INTERVAL_MS=15000
# NOTIFY_WORKER_BATCH=10
# NOTIFY_BACKOFF_BASE_MS=60000
# NOTIFY_BACKOFF_CAP_MS=3600000
# NOTIFY_RPS_DEFAULT=0
# NOTIFY_RPS_BY_MERCHANT="M-1=5,M-2=3"

# Antifraud guard
ANTIFRAUD_GUARD=on

# Antifraud defaults (overridable per-merchant in Admin -> Anti-Fraud)
# Per-scope rate limits and windows (seconds)
AF_LIMIT_MERCHANT=200
AF_WINDOW_MERCHANT_SEC=3600
AF_LIMIT_OUTLET=20
AF_WINDOW_OUTLET_SEC=600
AF_LIMIT_DEVICE=20
AF_WINDOW_DEVICE_SEC=600
AF_LIMIT_STAFF=60
AF_WINDOW_STAFF_SEC=600
AF_LIMIT_CUSTOMER=5
AF_WINDOW_CUSTOMER_SEC=120

# Optional daily caps (0 = disabled)
AF_DAILY_CAP_MERCHANT=0
AF_DAILY_CAP_OUTLET=0
AF_DAILY_CAP_DEVICE=0
AF_DAILY_CAP_STAFF=0
AF_DAILY_CAP_CUSTOMER=0

# Optional weekly caps (0 = disabled)
AF_WEEKLY_CAP_MERCHANT=0
AF_WEEKLY_CAP_OUTLET=0
AF_WEEKLY_CAP_DEVICE=0
AF_WEEKLY_CAP_STAFF=0
AF_WEEKLY_CAP_CUSTOMER=0
